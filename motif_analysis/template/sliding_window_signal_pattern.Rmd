---
title: "Motif Analysis - sliding window, the pattern of the signal"
output:
  html_document:
    number_sections: true
    toc: true
    toc_depth: 3
date: "`r format(Sys.time(), '%B %d, %Y')`"
---
  
```{r setup}
knitr::opts_knit$set(root.dir = '{envir}')
```

# How signal distributes along a sequence

```{r}
library(ggplot2)
mask.size <- {mask_size}
file.labels <- c('negative.negative', 'positive.random', 'positive.positive')
file.prefix <- '{prefix_dir}/sliding_window/signal_'
file.suffix <- paste0('.MaskSize_', mask.size, '.txt' )
signals <- list()
for(l in file.labels) {
  file.name <- paste0(file.prefix, l, file.suffix)
  signal <- read.table(file.name, sep = ' ', header = T)
  signals[[l]] <- signal
  ggplot(signal) + geom_bin2d(aes(x = pos_id, y = seq_id), binwidth = 1) + ggtitle(paste0('Signal distribution in ', l))
}
```

# How many signal blocks in a sequence

We merge all overlapping signals into signal blocks.

```{r}
count_nblock <- function(x) {
  if(length(x) == 1) {
    return(1)
  }
  count <- 1
  pre <- x[1]  # In the input file, the pos_id is 1-based
  for(i in 2 : length(x)) {
    if((x[i] - pre) > mask.size) {
      count <- count + 1
      pre <- x[i]
    }
  }
  return(count)
}
for(l in names(signals)) {
  nblock <- aggregate(pos_id ~ seq_id, data = signals[[l]], count_nblock)
  colnames(nblock) <- c('seq_id', 'nblock')
  ggplot(nblock) + geom_bar(aes(x = nblock)) + ggtitle(paste0('Number of separated signal blocks per sequence \n in ', l))
}
```
